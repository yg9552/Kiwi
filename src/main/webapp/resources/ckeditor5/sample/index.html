<!DOCTYPE html><!--
	Copyright (c) 2014-2022, CKSource Holding sp. z o.o. All rights reserved.
	This file is licensed under the terms of the MIT License (see LICENSE.md).
-->
// Using ES6 imports:
import ClassicEditor from '@ckeditor/ckeditor5-build-classic';

<html lang="en" dir="ltr">
	<head>
		<title>CKEditor 5 ClassicEditor build</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="icon" type="image/png" href="https://c.cksource.com/a/1/logos/ckeditor5.png">
		<link rel="stylesheet" type="text/css" href="styles.css">
		<script src="https://cdn.ckeditor.com/ckeditor5/35.2.1/classic/ckeditor.js"></script>
		
	</head>
	<body data-editor="ClassicEditor" data-collaboration="false" data-revision-history="false">
		<header>
			<div class="centered">
				<h1><a href="https://ckeditor.com/ckeditor-5/" target="_blank" rel="noopener noreferrer"><img src="https://c.cksource.com/a/1/logos/ckeditor5.svg" alt="CKEditor 5 logo">CKEditor 5</a></h1>
				<nav>
					<ul>
						<li><a href="https://ckeditor.com/docs/ckeditor5/" target="_blank" rel="noopener noreferrer">Documentation</a></li>
						<li><a href="https://ckeditor.com/" target="_blank" rel="noopener noreferrer">Website</a></li>
					</ul>
				</nav>
			</div>
		</header>
		<main>
			<div class="message">
				<div class="centered">
					<h2>CKEditor 5 online builder demo - ClassicEditor build</h2>
				</div>
			</div>
			<div class="centered">
				<div class="row row-editor">
					<div class="editor-container">
						<div class="editor">
							
						</div>
					</div>
				</div></div>
			</div>
		</main>
		<footer>
			<p><a href="https://ckeditor.com/ckeditor-5/" target="_blank" rel="noopener">CKEditor 5</a>
				– Rich text editor of tomorrow, available today
			</p>
			<p>Copyright © 2003-2022,
				<a href="https://cksource.com/" target="_blank" rel="noopener">CKSource</a>
				Holding sp. z o.o. All rights reserved.
			</p>
		</footer>
		<script src="../build/ckeditor.js"></script>
		<script>ClassicEditor
				.create( document.querySelector( '.editor' ), {
					
					licenseKey: '',
					
					
					
				} )
				.then( editor => {
					window.editor = editor;
			
					
					
					
				} )
				.catch( error => {
					console.error( 'Oops, something went wrong!' );
					console.error( 'Please, report the following error on https://github.com/ckeditor/ckeditor5/issues with the build id and the error stack trace:' );
					console.warn( 'Build id: ixldq3ruwlq5-735fjlurm1f2' );
					console.error( error );
				} );
		</script>
		<script>
		class StudioUploadAdapter {
			  constructor(loader) {
			    // CKEditor5's FileLoader instance.
			    this.loader = loader;
			    // URL where to send files.
			    this.url = `${API_ROOT_URL}/data/images/0/upload`;
			  }
			  // Starts the upload process.
			  upload() {
			    return new Promise((resolve, reject) => {
			      this._initRequest();
			      this._initListeners(resolve, reject);
			      this._sendRequest();
			    });
			  }
			  // Aborts the upload process.
			  abort() {
			    if (this.xhr) {
			      this.xhr.abort();
			    }
			  }
			  // Example implementation using XMLHttpRequest.
			  _initRequest() {
			    const xhr = (this.xhr = new XMLHttpRequest());
			    xhr.open("POST", this.url, true);
			    xhr.responseType = "json";
			  }
			  // Initializes XMLHttpRequest listeners.
			  _initListeners(resolve, reject) {
			    const xhr = this.xhr;
			    const loader = this.loader;
			    const genericErrorText = "Couldn't upload file:" + ` ${loader.file.name}.`;
			    xhr.addEventListener("error", () => reject(genericErrorText));
			    xhr.addEventListener("abort", () => reject());
			    xhr.addEventListener("load", () => {
			      const response = xhr.response;
			      console.log(response);
			      if (!response || response.error) {
			        return reject(
			          response && response.error ? response.error.message : genericErrorText
			        );
			      }
			      // If the upload is successful, resolve the upload promise with an object containing
			      // at least the "default" URL, pointing to the image on the server.
			      resolve({
			        default: getDownloadUrl(response[0]),
			      });
			    });
			    if (xhr.upload) {
			      xhr.upload.addEventListener("progress", (evt) => {
			        if (evt.lengthComputable) {
			          loader.uploadTotal = evt.total;
			          loader.uploaded = evt.loaded;
			        }
			      });
			    }
			  }
			  // Prepares the data and sends the request.
			  _sendRequest() {
			    const data = new FormData();
			    let that = this;
			    let file = that.loader.file;
			     
			    // set jwt token if required.
			    that.xhr.setRequestHeader("Authorization", authHeader().Authorization);
			    file.then(function (result) {
			      //wait for the promise to finish then continue
			      data.append("upload", result);
			      that.xhr.send(data);
			    });
			  }
			}
			 
			/**
			 * return full image url with responsed JSON object
			 * 
			 * @param {*} item 
			 */
			function getDownloadUrl(item) {
			  return encodeURI(`${API_ROOT_URL}/download/images/${item.linkId}`);
			}
			 
			 function StudioUploadAdapterPlugin(editor) {
				  editor.plugins.get("FileRepository").createUploadAdapter = (loader) => {
				    return new StudioUploadAdapter(loader);
				  };
				}
			 
			 function createCKEditor5(renderTo, options, callback) {
				  renderTo = renderTo || $("#ckeditor");
				  var $headers = headerWithAuth({});
				  return ClassicEditor.create(renderTo.get(0), {
				    extraPlugins: [StudioUploadAdapterPlugin],
				    mediaEmbed: {
				      previewsInData: true,
				      extraProviders: [
				        {
				          name: "me",
				          url: /^.*\/download/,
				          html: match => {
				            const id = match[ 1 ];
				            return 'hello';
				          }
				        },
				      ],
				    },
				    image: {
				      // Configure the available styles.
				      styles: ["alignLeft", "alignCenter", "alignRight"],      
				      // You need to configure the image toolbar, too, so it shows the new style
				      // buttons as well as the resize buttons.
				      toolbar: [
				        "imageStyle:alignLeft",
				        "imageStyle:alignCenter",
				        "imageStyle:alignRight",
				        "|",
				        "imageTextAlternative",
				      ],
				    },
				  })
				    .then((editor) => {
				      window.ckeditor = editor;
				      if (isFunction(callback)) {
				        callback(editor);
				      }
				    })
				    .catch((error) => {
				      console.error("There was a problem initializing the editor.", error);
				    });
				}
	
		
		</script>
	</body>
</html>