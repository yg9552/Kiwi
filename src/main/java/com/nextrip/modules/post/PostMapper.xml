<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.nextrip.modules.post.PostMapper">

    <resultMap id="resultMapObj" type="com.nextrip.modules.post.Post"></resultMap>
	
<select id="postSelectList" resultMap="resultMapObj">
	<include refid="Base.selectListUpperForMysql" />
	select
		a.nxPostSeq
		,a.memberSeq
		,a.region
		,a.postType
		,a.addressTitle
		,a.title
		,a.regDateTime
		,b.nickName as memberNickName
	<include refid="userSelectCommon" />
	ORDER BY nxPostSeq DESC
	<include refid="Base.selectListLowerForMysql" />
	
</select>

<select id="postSelectListCount" resultType="Integer">
	select
		count(*)
	<include refid="userSelectCommon" />
</select>

<select id="postSelectOne" resultMap="resultMapObj">	

	select
		a.*
		,b.nickName as memberNickName
	from nxPost a
	join member b on a.memberSeq = b.memberSeq
	where 1=1
	and nxPostSeq = #{nxPostSeq}
	
</select>

<sql id ="userSelectCommon">
	FROM nxPost a
	JOIN member b on a.memberSeq = b.memberSeq
	where 1=1
		<if test="shPostType != null and !shPostType.equals('')">AND a.postType = #{shPostType}</if>
		<if test="shRegion != null and !shRegion.equals('')">AND a.region = #{shRegion}</if>
		<choose>
			<when test="shOption == 1">AND a.title LIKE CONCAT('%',#{shValue},'%')</when>
			<when test="shOption == 2">AND a.content = #{shValue} </when>
			<when test="shOption == 3">AND b.addressTitle LIKE CONCAT('%',#{shValue},'%')</when>
		</choose>
	</sql>

<insert id="postInsert">
	INSERT INTO nxPost (
			memberSeq
			,region
			,postType
			,addressTitle
			,title
			,content
			,addressZip
			,address
			,addressDetail
			,lng
			,lat
			,delNy
		)
		VALUES (
			#{memberSeq}
			,#{region}
			,#{postType}
			,#{addressTitle}
			,#{title}
			,#{content}
			,#{addressZip}
			,#{address}
			,#{addressDetail}
			,#{lng}
			,#{lat}
			,0
		)
		<selectKey resultType="String" keyProperty="nxPostSeq" order="AFTER">
			SELECT last_insert_id()
		</selectKey>
</insert>

<update id="postUpdate">
	UPDATE nxPost
		SET
		region = #{region}
		,postType = #{postType}
		,title = #{title}
		,content = #{content}
		,addressZip = #{addressZip}
		,address = #{address}
		,addressDetail = #{addressDetail}
		,lng = #{lng}
		,lat = #{lat}
	WHERE 1=1
		AND	nxPostSeq = #{nxPostSeq}
</update>

<update id="postUelete">
	UPDATE nxPost
	SET
		delNy = 1
	WHERE 1=1
		AND	nxPostSeq = #{nxPostSeq}
</update>

<delete id="postDelete">
	DELETE 
	FROM nxPost 
	WHERE 1=1 
		AND	nxPostSeq = #{nxPostSeq}

</delete>
	
</mapper>	